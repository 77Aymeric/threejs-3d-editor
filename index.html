<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Constructeur 3D Pro</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600&display=swap" rel="stylesheet">
    <!-- Import Map for bare modules -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.128.0/build/three.module.js",
                "three/examples/jsm/controls/OrbitControls": "https://unpkg.com/three@0.128.0/examples/jsm/controls/OrbitControls.js",
                "three/examples/jsm/controls/TransformControls": "https://unpkg.com/three@0.128.0/examples/jsm/controls/TransformControls.js"
            }
        }
    </script>
    <!-- Main Style -->
    <link rel="stylesheet" href="./src/styles/main.css">
    <style>
        body {
            font-family: 'Outfit', sans-serif;
        }
    </style>
</head>

<body class="bg-[#1a1a1a] text-white">

    <!-- TOOLBAR -->
    <div id="ui-toolbar" class="shadow-lg backdrop-blur-md">
        <div class="flex gap-2 mr-4 border-r border-gray-600 pr-4">
            <button class="btn btn-secondary" onclick="undo()" title="Annuler (Ctrl+Z)">‚Ü©</button>
            <button class="btn btn-secondary" onclick="redo()" title="R√©tablir (Ctrl+Y)">‚Ü™</button>
        </div>

        <div class="flex gap-2 mr-4 border-r border-gray-600 pr-4">
            <button class="btn" onclick="ajouterAction('cube')">+ Cube</button>
            <button class="btn" onclick="ajouterAction('cylindre')">+ Cylindre</button>
            <button class="btn" onclick="ajouterAction('triangle')">+ Triangle</button>
        </div>

        <div class="flex gap-2 mr-4 border-r border-gray-600 pr-4">
            <button class="btn btn-secondary" onclick="setMode('translate')" title="D√©placer (Z)">‚úõ (Z)</button>
            <button class="btn btn-secondary" onclick="setMode('rotate')" title="Tourner (R)">‚Üª (R)</button>
            <button class="btn btn-secondary" onclick="setMode('scale')" title="Redimensionner (S)">‚§° (S)</button>
        </div>

        <div class="flex gap-2 mr-4 border-r border-gray-600 pr-4">
            <button class="btn btn-secondary w-32" id="btn-cam" onclick="toggleCamera()">Cam: Persp</button>
        </div>

        <div class="flex gap-4 mr-4 items-center">
            <label class="toggle-container bg-gray-800 px-3 py-1 rounded border border-gray-600">
                <span class="text-xs">Aimant</span>
                <input type="checkbox" id="snap-toggle" class="toggle-checkbox" onchange="toggleSnap(this.checked)">
                <div class="toggle-switch"></div>
            </label>

            <label class="toggle-container bg-gray-800 px-3 py-1 rounded border border-gray-600"
                title="Orientation des fl√®ches : Monde ou Objet">
                <span class="text-xs">Local</span>
                <input type="checkbox" id="local-toggle" class="toggle-checkbox" onchange="toggleSpace(this.checked)">
                <div class="toggle-switch"></div>
            </label>

            <label class="toggle-container bg-gray-800 px-3 py-1 rounded border border-gray-600"
                title="Afficher les couleurs / Mode Gris">
                <span class="text-xs">Couleurs</span>
                <input type="checkbox" id="colors-toggle" class="toggle-checkbox" checked
                    onchange="toggleColors(this.checked)">
                <div class="toggle-switch"></div>
            </label>

            <label class="toggle-container bg-gray-800 px-3 py-1 rounded border border-gray-600"
                title="Afficher les lignes (Wireframes)">
                <span class="text-xs">Lignes</span>
                <input type="checkbox" id="lines-toggle" class="toggle-checkbox" checked
                    onchange="toggleWireframes(this.checked)">
                <div class="toggle-switch"></div>
            </label>
        </div>

        <div style="flex-grow:1"></div>
        <button class="btn btn-warning" onclick="ouvrirModalImport()">üìÇ Import</button>
    </div>

    <!-- PANEL ARBORESCENCE (GAUCHE) -->
    <div id="ui-tree-panel" class="shadow-xl">
        <div id="tree-toggle-btn" class="hover:bg-gray-600 transition-colors">‚óÄ</div>
        <div id="tree-header" class="flex justify-between items-center">
            <span>Objets</span>
            <span id="obj-count" class="bg-gray-700 px-2 py-0.5 rounded text-xs">0</span>
        </div>
        <div id="tree-list"></div>
    </div>

    <!-- PANEL PROPRIETES (DROITE) -->
    <div id="ui-sidebar" class="shadow-xl">
        <h2 class="text-xl font-bold mb-2">Propri√©t√©s</h2>
        <div id="no-selection" class="text-gray-500 italic text-sm">S√©lectionnez un objet ou utilisez Shift+Clic pour
            plusieurs.</div>

        <div id="object-properties" style="display:none;" class="flex flex-col gap-4">
            <div class="bg-blue-900/30 p-2 rounded border border-blue-800 text-sm">
                <span id="selection-count" class="font-bold text-blue-400">1</span> objet(s) s√©lectionn√©(s)
            </div>

            <div class="control-group" id="group-name">
                <span class="control-label">Nom</span>
                <input type="text" id="input-name" onchange="majNom(this.value)">
            </div>

            <div class="flex gap-2">
                <button class="btn btn-secondary flex-1" onclick="dupliquerSelection()">‚ùê Dupliquer</button>
            </div>

            <div class="control-group">
                <label class="control-label mb-2">Position (Globale)</label>
                <div class="coord-row"><span class="coord-label text-red-500">X</span><input type="number" step="0.1"
                        id="pos-x" onchange="majPositionParInput()"></div>
                <div class="coord-row"><span class="coord-label text-green-500">Y</span><input type="number" step="0.1"
                        id="pos-y" onchange="majPositionParInput()"></div>
                <div class="coord-row"><span class="coord-label text-blue-500">Z</span><input type="number" step="0.1"
                        id="pos-z" onchange="majPositionParInput()"></div>
            </div>

            <div class="control-group">
                <label class="control-label">Couleur</label>
                <input type="color" id="input-color" oninput="majCouleur(this.value)">
            </div>

            <button class="btn btn-danger w-full" onclick="supprimerSelection()">Supprimer (Suppr)</button>
        </div>

        <div style="flex-grow: 1;"></div>
        <div class="control-group border-t border-gray-600 pt-4">
            <button class="btn btn-success w-full" onclick="exporterCode()">üíæ Exporter Code</button>
        </div>
    </div>

    <!-- MODAL IMPORT -->
    <div id="modal-import" class="backdrop-blur-sm">
        <div class="modal-content shadow-2xl">
            <h3 class="text-xl font-bold">Importer du Code</h3>
            <p class="text-sm text-gray-400">Collez une fonction JS ou un script Three.js.</p>
            <textarea id="import-area" placeholder="// function maVoiture() { ... }"></textarea>
            <div class="flex gap-2 justify-end">
                <button class="btn btn-secondary" onclick="fermerModalImport()">Annuler</button>
                <button class="btn btn-success" onclick="executerImport()">Importer</button>
            </div>
        </div>
    </div>

    <div id="canvas-container"></div>

    <!-- Main Module -->
    <script type="module" src="./src/main.js"></script>
</body>

</html>